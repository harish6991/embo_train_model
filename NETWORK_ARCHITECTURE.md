# 🏗️ EMBROIDERY GENERATION - NETWORK ARCHITECTURE

## 📊 CYCLEGAN ARCHITECTURE OVERVIEW

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           CYCLEGAN NETWORK ARCHITECTURE                        │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   DOMAIN A      │    │   GENERATOR A   │    │   DOMAIN B      │    │   GENERATOR B   │
│   (Normal)      │    │   (A → B)       │    │   (Embroidery)  │    │   (B → A)       │
│                 │    │                 │    │                 │    │                 │
│  ┌─────────┐    │    │  ┌───────────┐  │    │  ┌─────────┐    │    │  ┌───────────┐  │
│  │  Input  │───▶│    │  │ ResNet-9  │  │    │  │ Output  │    │    │  │ ResNet-9  │  │
│  │  Image  │    │    │  │  Blocks   │  │    │  │Embroidery│    │    │  │  Blocks   │  │
│  │ 256x256 │    │    │  │ Generator │  │    │  │ 256x256  │    │    │  │ Generator │  │
│  └─────────┘    │    │  └───────────┘  │    │  └─────────┘    │    │  └───────────┘  │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │                       │
         │                       ▼                       │                       │
         │              ┌─────────────────┐              │                       │
         │              │   DISCRIMINATOR │              │                       │
         │              │       A         │              │                       │
         │              │   (PatchGAN)    │              │                       │
         │              └─────────────────┘              │                       │
         │                       │                       │                       │
         │                       ▼                       │                       │
         │              ┌─────────────────┐              │                       │
         │              │   CYCLE LOSS    │              │                       │
         │              │   (A→B→A)       │              │                       │
         │              └─────────────────┘              │                       │
         │                       │                       │                       │
         └───────────────────────┼───────────────────────┘                       │
                                 │                                               │
                                 ▼                                               │
                    ┌─────────────────┐                                         │
                    │   IDENTITY LOSS │                                         │
                    │   (A→A, B→B)    │                                         │
                    └─────────────────┘                                         │
                                 │                                               │
                                 ▼                                               │
                    ┌─────────────────┐                                         │
                    │   ADVERSARIAL   │                                         │
                    │     LOSS        │                                         │
                    └─────────────────┘                                         │
                                 │                                               │
                                 ▼                                               │
                    ┌─────────────────┐                                         │
                    │   TOTAL LOSS    │                                         │
                    │   (Combined)    │                                         │
                    └─────────────────┘                                         │
                                 │                                               │
                                 ▼                                               │
                    ┌─────────────────┐                                         │
                    │   BACKPROP      │                                         │
                    │   & UPDATE      │                                         │
                    └─────────────────┘                                         │
```

---

## 🔧 RESNET-9BLOCKS GENERATOR ARCHITECTURE

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        RESNET-9BLOCKS GENERATOR DETAILS                        │
└─────────────────────────────────────────────────────────────────────────────────┘

INPUT: 256x256x3 (RGB Image)
       │
       ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              ENCODER PATH                                      │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Reflection  │    │ Conv2d      │    │ Instance    │    │ ReLU        │
│ Pad2d(3)    │───▶│ 7x7, 64     │───▶│ Norm2d      │───▶│ Activation  │
│             │    │             │    │             │    │             │
│ 262x262x3   │    │ 256x256x64  │    │ 256x256x64  │    │ 256x256x64  │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │
       ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            DOWNSAMPLING LAYERS                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Conv2d      │    │ Instance    │    │ ReLU        │    │ Conv2d      │
│ 3x3, 128    │───▶│ Norm2d      │───▶│ Activation  │───▶│ 3x3, 256    │
│ stride=2    │    │             │    │             │    │ stride=2    │
│             │    │             │    │             │    │             │
│ 128x128x128 │    │ 128x128x128 │    │ 128x128x128 │    │ 64x64x256   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │
       ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Instance    │    │ ReLU        │    │             │
│ Norm2d      │───▶│ Activation  │───▶│             │
│             │    │             │    │             │
│ 64x64x256   │    │ 64x64x256   │    │ 64x64x256   │
└─────────────┘    └─────────────┘    └─────────────┘
       │
       ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            RESNET BLOCKS (9x)                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ ResNet      │    │ ResNet      │    │ ResNet      │    │ ResNet      │
│ Block 1     │───▶│ Block 2     │───▶│ Block 3     │───▶│ Block 4     │
│             │    │             │    │             │    │             │
│ 64x64x256   │    │ 64x64x256   │    │ 64x64x256   │    │ 64x64x256   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │
       ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ ResNet      │    │ ResNet      │    │ ResNet      │    │ ResNet      │
│ Block 5     │───▶│ Block 6     │───▶│ Block 7     │───▶│ Block 8     │
│             │    │             │    │             │    │             │
│ 64x64x256   │    │ 64x64x256   │    │ 64x64x256   │    │ 64x64x256   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │
       ▼
┌─────────────┐
│ ResNet      │
│ Block 9     │
│             │
│ 64x64x256   │
└─────────────┘
       │
       ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            UPSAMPLING LAYERS                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ ConvTrans-  │    │ Instance    │    │ ReLU        │    │ ConvTrans-  │
│ pose2d      │───▶│ Norm2d      │───▶│ Activation  │───▶│ pose2d      │
│ 3x3, 128    │    │             │    │             │    │ 3x3, 64     │
│ stride=2    │    │             │    │             │    │ stride=2    │
│             │    │             │    │             │    │             │
│ 128x128x128 │    │ 128x128x128 │    │ 128x128x128 │    │ 256x256x64  │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │
       ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Instance    │    │ ReLU        │    │             │
│ Norm2d      │───▶│ Activation  │───▶│             │
│             │    │             │    │             │
│ 256x256x64  │    │ 256x256x64  │    │ 256x256x64  │
└─────────────┘    └─────────────┘    └─────────────┘
       │
       ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              DECODER PATH                                      │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Reflection  │    │ Conv2d      │    │ Tanh        │    │ OUTPUT      │
│ Pad2d(3)    │───▶│ 7x7, 3      │───▶│ Activation  │───▶│ 256x256x3   │
│             │    │             │    │             │    │ (RGB)       │
│ 262x262x64  │    │ 256x256x3   │    │ 256x256x3   │    │             │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

---

## 🎯 PATCHGAN DISCRIMINATOR ARCHITECTURE

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        PATCHGAN DISCRIMINATOR DETAILS                          │
└─────────────────────────────────────────────────────────────────────────────────┘

INPUT: 256x256x3 (Generated or Real Image)
       │
       ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Conv2d      │    │ LeakyReLU   │    │ Conv2d      │    │ Instance    │
│ 4x4, 64     │───▶│ (0.2)       │───▶│ 4x4, 128    │───▶│ Norm2d      │
│ stride=2    │    │             │    │ stride=2    │    │             │
│             │    │             │    │             │    │             │
│ 128x128x64  │    │ 128x128x64  │    │ 64x64x128   │    │ 64x64x128   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │
       ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ LeakyReLU   │    │ Conv2d      │    │ Instance    │    │ LeakyReLU   │
│ (0.2)       │───▶│ 4x4, 256    │───▶│ Norm2d      │───▶│ (0.2)       │
│             │    │ stride=2    │    │             │    │             │
│             │    │             │    │             │    │             │
│ 64x64x128   │    │ 32x32x256   │    │ 32x32x256   │    │ 32x32x256   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │
       ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Conv2d      │    │ LeakyReLU   │    │ Conv2d      │
│ 4x4, 1      │───▶│ (0.2)       │───▶│ 4x4, 1      │
│ stride=1    │    │             │    │ stride=1    │
│             │    │             │    │             │
│ 32x32x1     │    │ 32x32x1     │    │ 30x30x1     │
└─────────────┘    └─────────────┘    └─────────────┘
       │
       ▼
┌─────────────┐
│ OUTPUT      │
│ 30x30x1     │
│ (Patch      │
│  Scores)    │
└─────────────┘
```

---

## 🔄 RESNET BLOCK INTERNAL STRUCTURE

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            RESNET BLOCK DETAILS                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

INPUT: 64x64x256
       │
       ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Reflection  │    │ Conv2d      │    │ Instance    │    │ ReLU        │
│ Pad2d(1)    │───▶│ 3x3, 256    │───▶│ Norm2d      │───▶│ Activation  │
│             │    │             │    │             │    │             │
│ 66x66x256   │    │ 64x64x256   │    │ 64x64x256   │    │ 64x64x256   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │
       ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Reflection  │    │ Conv2d      │    │ Instance    │    │ ADD         │
│ Pad2d(1)    │───▶│ 3x3, 256    │───▶│ Norm2d      │───▶│ (Skip       │
│             │    │             │    │             │    │  Connection)│
│ 66x66x256   │    │ 64x64x256   │    │ 64x64x256   │    │             │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                                                      │
       └──────────────────────────────────────────────────────┘
                                                              │
                                                              ▼
                                                      ┌─────────────┐
                                                      │ OUTPUT      │
                                                      │ 64x64x256   │
                                                      └─────────────┘
```

---

## 📊 LOSS FUNCTIONS ARCHITECTURE

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            LOSS FUNCTIONS FLOW                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ GAN Loss A  │    │ GAN Loss B  │    │ Cycle Loss  │    │ Identity    │
│ (D_A vs     │    │ (D_B vs     │    │ A→B→A       │    │ Loss        │
│  G_A)       │    │  G_B)       │    │ B→A→B       │    │ A→A, B→B    │
│             │    │             │    │             │    │             │
│ L1 Loss     │    │ L1 Loss     │    │ L1 Loss     │    │ L1 Loss     │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       └───────────────────┼───────────────────┼───────────────────┘
                           │                   │
                           ▼                   ▼
                  ┌─────────────┐    ┌─────────────┐
                  │ Generator   │    │ Discriminator│
                  │ Loss        │    │ Loss        │
                  │ (Combined)  │    │ (Combined)  │
                  └─────────────┘    └─────────────┘
                           │                   │
                           └───────────────────┘
                                   │
                                   ▼
                          ┌─────────────┐
                          │ TOTAL LOSS  │
                          │ (Weighted   │
                          │  Sum)       │
                          └─────────────┘
```

---

## 🎯 KEY ARCHITECTURE SPECIFICATIONS

### **Generator (ResNet-9blocks):**
- **Input**: 256×256×3 (RGB)
- **Output**: 256×256×3 (RGB)
- **Parameters**: ~11.4M
- **Architecture**: Encoder → 9 ResNet Blocks → Decoder
- **Normalization**: Instance Normalization
- **Activation**: ReLU + Tanh

### **Discriminator (PatchGAN):**
- **Input**: 256×256×3 (RGB)
- **Output**: 30×30×1 (Patch scores)
- **Parameters**: ~1.1M
- **Architecture**: 3-layer CNN
- **Normalization**: Instance Normalization
- **Activation**: LeakyReLU

### **Training Configuration:**
- **Batch Size**: 1 (during training)
- **Learning Rate**: 0.0002
- **Optimizer**: Adam (β1=0.5, β2=0.999)
- **Loss Weights**: λ_A=10, λ_B=10, λ_identity=0.5
- **Epochs**: 150 + 150 decay

---

## 🚀 INFERENCE FLOW

```
INPUT IMAGE (256x256x3)
         │
         ▼
    NORMALIZE [-1,1]
         │
         ▼
   GENERATOR A (ResNet-9)
         │
         ▼
   GENERATE EMBROIDERY
         │
         ▼
    DENORMALIZE [0,1]
         │
         ▼
    CROP PADDING (3px)
         │
         ▼
OUTPUT EMBROIDERY (250x250x3)
```

---

*This architecture enables high-quality image-to-image translation from normal images to realistic embroidery-style images!* 🎨✨
